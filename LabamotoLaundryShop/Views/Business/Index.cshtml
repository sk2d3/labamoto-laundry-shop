@model LabamotoLaundryShop.Models.BusinessSettingsViewModel
@{
    Layout = "~/Views/Shared/_OwnerLayout.cshtml";
    ViewBag.Title = "Business & System Settings";
}
<style>
    .settings-container {
        max-width: 1250px;
        margin: 20px auto;
        padding: 30px 40px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 15px rgba(0,0,0,0.08);
    }
    .settings-container h2 {
        color: #0d6efd;
        font-weight: 600;
        margin-bottom: 20px;
        font-size: 25px;
    }

    .settings-header {
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 15px;
        margin-bottom: 25px;
    }

        .settings-header h2 {
            color: #0d6efd;
            font-weight: 600;
            margin: 0;
            font-size: 25px;
        }

    .nav-tabs .nav-link {
        border: none;
        border-radius: 8px 8px 0 0;
        font-weight: 500;
        padding: 12px 20px;
        color: #6c757d;
        background: #f8f9fa;
    }

        .nav-tabs .nav-link.active {
            color: #0d6efd;
            background: #fff;
            border-bottom: 2px solid #0d6efd;
        }

    .form-section {
        background: white;
        border-radius: 6px;
        padding: 30px 40px;
        margin-bottom: 20px;
        border: 1px solid #e0e7ff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

        .form-section h5 {
            color: #495057;
            font-size: 21px;
            margin-bottom: 15px;
            font-weight: 600;
        }

    .btn-save-section {
        border-top: 1px solid #e9ecef;
        padding-top: 15px;
        margin-top: 20px;
        text-align: right;
    }

    .holiday-row {
        background: white;
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 8px;
        border: 1px solid #dee2e6;
    }

    .payment-item {
        background: white;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 10px;
        border-left: 3px solid #0d6efd;
    }

    @@media (max-width: 768px) {
        .settings-container {
            padding: 15px;
        }

        .nav-tabs {
            flex-wrap: wrap;
        }

        .nav-link {
            font-size: 14px;
            padding: 8px 12px;
        }

        .btn-save-section {
            text-align: center;
        }
    }
</style>

<div class="settings-container">
    <!-- Header -->
    <div class="mb-3 header">
        <a href="@Url.Action("Dashboard", "Owner")" class="btn btn-outline-secondary mb-2">← Back</a>
        <h2 class="mb-1">🔧 Business & System Settings</h2>
        <p class="text-muted">Configure your laundry shop settings</p>
    </div>

    <!-- Alerts -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @using (Html.BeginForm("SaveAll", "Business", FormMethod.Post, new { @class = "needs-validation", novalidate = "novalidate" }))
    {
        @Html.AntiForgeryToken()

        <!-- Hidden input inside your form -->
        <input type="hidden" id="ActiveTabInput" name="ActiveTab" value="@ViewBag.ActiveTab" />

        <!-- TABS NAVIGATION -->
        <ul class="nav nav-tabs mb-4" role="tablist">
            <li class="nav-item">
                <button class="nav-link @(ViewBag.ActiveTab=="general-info"?"active":"")"
                        data-bs-toggle="tab" data-bs-target="#general-info"
                        type="button" onclick="setActiveTab('general-info')">
                    <i class="bi bi-building me-1"></i> General Info
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link @(ViewBag.ActiveTab=="business-hours"?"active":"")"
                        data-bs-toggle="tab" data-bs-target="#business-hours"
                        type="button" onclick="setActiveTab('business-hours')">
                    <i class="bi bi-clock me-1"></i> Business Hours
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link @(ViewBag.ActiveTab=="payment-methods"?"active":"")"
                        data-bs-toggle="tab" data-bs-target="#payment-methods"
                        type="button" onclick="setActiveTab('payment-methods')">
                    <i class="bi bi-credit-card me-1"></i> Payment Methods
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link @(ViewBag.ActiveTab=="system-config"?"active":"")"
                        data-bs-toggle="tab" data-bs-target="#system-config"
                        type="button" onclick="setActiveTab('system-config')">
                    <i class="bi bi-gear me-1"></i> System Config
                </button>
            </li>
        </ul>



        <!-- TAB CONTENT -->
        <div class="tab-content">
            <!-- GENERAL INFO TAB -->
            <div class="tab-pane fade @(ViewBag.ActiveTab == "general-info" ? "show active" : "")" id="general-info" role="tabpanel">
                <div class="tab-card">
                    <!-- Business Information Section -->
                    <div class="form-section">
                        <h5><i class="bi bi-building text-primary me-2"></i>Business Information</h5>
                        @{
                            Func<string, string> gval = key => Model.GeneralInfo?.Find(x => x.SettingKey == key)?.SettingValue ?? "";
                        }
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Business Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="GeneralInfo[0].SettingValue"
                                       value="@gval("BusinessName")" required />
                                <input type="hidden" name="GeneralInfo[0].SettingKey" value="BusinessName" />
                                <input type="hidden" name="GeneralInfo[0].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="BusinessName")?.Id ?? 0)" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Business Phone</label>
                                <input type="tel" class="form-control" name="GeneralInfo[1].SettingValue"
                                       value="@gval("BusinessPhone")" />
                                <input type="hidden" name="GeneralInfo[1].SettingKey" value="BusinessPhone" />
                                <input type="hidden" name="GeneralInfo[1].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="BusinessPhone")?.Id ?? 0)" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" name="GeneralInfo[2].SettingValue"
                                       value="@gval("BusinessEmail")" />
                                <input type="hidden" name="GeneralInfo[2].SettingKey" value="BusinessEmail" />
                                <input type="hidden" name="GeneralInfo[2].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="BusinessEmail")?.Id ?? 0)" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tax ID / TIN</label>
                                <input type="text" class="form-control" name="GeneralInfo[4].SettingValue"
                                       value="@gval("TaxID")" />
                                <input type="hidden" name="GeneralInfo[4].SettingKey" value="TaxID" />
                                <input type="hidden" name="GeneralInfo[4].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="TaxID")?.Id ?? 0)" />
                            </div>
                            <div class="col-12">
                                <label class="form-label">Business Address</label>
                                <textarea class="form-control" name="GeneralInfo[3].SettingValue" rows="2">@gval("BusinessAddress")</textarea>
                                <input type="hidden" name="GeneralInfo[3].SettingKey" value="BusinessAddress" />
                                <input type="hidden" name="GeneralInfo[3].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="BusinessAddress")?.Id ?? 0)" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Business Permit No</label>
                                <input type="text" class="form-control" name="GeneralInfo[5].SettingValue"
                                       value="@gval("BusinessPermit")" />
                                <input type="hidden" name="GeneralInfo[5].SettingKey" value="BusinessPermit" />
                                <input type="hidden" name="GeneralInfo[5].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="BusinessPermit")?.Id ?? 0)" />
                            </div>
                        </div>
                    </div>

                    <!-- Receipt Settings Section -->
                    <div class="form-section">
                        <h5><i class="bi bi-receipt text-primary me-2"></i>Receipt & Invoice Settings</h5>
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Receipt Header Text</label>
                                <textarea class="form-control" name="GeneralInfo[6].SettingValue" rows="2">@gval("ReceiptHeader")</textarea>
                                <input type="hidden" name="GeneralInfo[6].SettingKey" value="ReceiptHeader" />
                                <input type="hidden" name="GeneralInfo[6].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="ReceiptHeader")?.Id ?? 0)" />
                            </div>
                            <div class="col-12">
                                <label class="form-label">Receipt Footer Text</label>
                                <textarea class="form-control" name="GeneralInfo[7].SettingValue" rows="2">@gval("ReceiptFooter")</textarea>
                                <input type="hidden" name="GeneralInfo[7].SettingKey" value="ReceiptFooter" />
                                <input type="hidden" name="GeneralInfo[7].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="ReceiptFooter")?.Id ?? 0)" />
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <!-- Hidden input ensures a value is always posted -->
                                    <input type="hidden" name="GeneralInfo[8].SettingValue" value="false" />

                                    <input class="form-check-input" type="checkbox" id="IncludeQRCode" name="GeneralInfo[8].SettingValue" value="true"
                                           @(gval("IncludeQRCode") == "true" ? "checked" : "") />
                                    <label class="form-check-label" for="IncludeQRCode">Include QR code on receipts</label>

                                    <input type="hidden" name="GeneralInfo[8].SettingKey" value="IncludeQRCode" />
                                    <input type="hidden" name="GeneralInfo[8].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="IncludeQRCode")?.Id ?? 0)" />
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input type="hidden" name="GeneralInfo[9].SettingValue" value="false" />

                                    <input class="form-check-input" type="checkbox" id="PrintLogo" name="GeneralInfo[9].SettingValue" value="true"
                                           @(gval("PrintLogo") == "true" ? "checked" : "") />
                                    <label class="form-check-label" for="PrintLogo">Print business logo</label>

                                    <input type="hidden" name="GeneralInfo[9].SettingKey" value="PrintLogo" />
                                    <input type="hidden" name="GeneralInfo[9].Id" value="@(Model.GeneralInfo?.Find(x=>x.SettingKey=="PrintLogo")?.Id ?? 0)" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="btn-save-section">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save me-2"></i>Save Business Information
                        </button>
                    </div>
                </div>
            </div>

            <!-- BUSINESS HOURS TAB -->
            <div class="tab-pane fade @(ViewBag.ActiveTab == "business-hours" ? "show active" : "")" id="business-hours" role="tabpanel">
                <div class="tab-card">
                    <!-- Operating Hours -->
                    <div class="form-section">
                        <h5><i class="bi bi-clock text-primary me-2"></i>Operating Hours</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Open Time</th>
                                        <th>Close Time</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @for (int i = 0; i < Model.BusinessHours.Count; i++)
                                    {
                                        var day = Model.BusinessHours[i];
                                        <tr>
                                            <td><strong>@day.Day</strong></td>
                                            <td><input type="time" class="form-control form-control-sm" name="BusinessHours[@i].OpenTime" value="@day.OpenTime" /></td>
                                            <td><input type="time" class="form-control form-control-sm" name="BusinessHours[@i].CloseTime" value="@day.CloseTime" /></td>
                                            <td>
                                                <select class="form-select form-select-sm" name="BusinessHours[@i].Status">
                                                    <option value="Open" @(day.Status == "Open" ? "selected" : "")>Open</option>
                                                    <option value="Closed" @(day.Status == "Closed" ? "selected" : "")>Closed</option>
                                                </select>
                                                <input type="hidden" name="BusinessHours[@i].Day" value="@day.Day" />
                                                <input type="hidden" name="BusinessHours[@i].Id" value="@day.Id" />
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Holidays -->
                    <div class="form-section">
                        <h5><i class="bi bi-calendar-x text-primary me-2"></i>Special Closures / Holidays</h5>
                        <div id="holidaysList">
                            @for (int h = 0; h < Model.Holidays.Count; h++)
                            {
                                var hol = Model.Holidays[h];
                                <div class="holiday-row">
                                    <input type="hidden" name="Holidays[@h].Id" value="@hol.Id" />
                                    <div class="row align-items-center g-2">
                                        <div class="col-md-3">
                                            <input type="date" class="form-control form-control-sm" name="Holidays[@h].Date"
                                                   value="@hol.Date.ToString("yyyy-MM-dd")" />
                                        </div>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control form-control-sm" name="Holidays[@h].Description"
                                                   value="@hol.Description" placeholder="Holiday description" />
                                        </div>
                                        <div class="col-md-1">
                                            <button type="button" class="btn btn-sm btn-outline-danger w-100 remove-holiday">×</button>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <button type="button" id="addHolidayBtn" class="btn btn-outline-primary btn-sm mt-2">
                            <i class="bi bi-plus"></i> Add Holiday
                        </button>
                    </div>

                    <div class="btn-save-section">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save me-2"></i>Save Business Hours
                        </button>
                    </div>
                </div>
            </div>

            <!-- PAYMENT METHODS TAB -->
            <div class="tab-pane fade @(ViewBag.ActiveTab == "payment-methods" ? "show active" : "")" id="payment-methods" role="tabpanel">
                <div class="tab-card">
                    <!-- Payment Methods -->
                    <div class="form-section">
                        <h5><i class="bi bi-credit-card text-primary me-2"></i>Accepted Payment Methods</h5>
                        @for (int p = 0; p < Model.PaymentMethods.Count; p++)
                        {
                            var pm = Model.PaymentMethods[p];
                            <div class="payment-item">
                                <div class="form-check d-flex align-items-start">
                                    <input class="form-check-input mt-0 me-3" type="checkbox" id="pm_@p"
                                           name="PaymentMethods[@p].Enabled" value="true" @(pm.Enabled ? "checked" : "") />
                                    <input type="hidden" name="PaymentMethods[@p].Id" value="@pm.Id" />
                                    <input type="hidden" name="PaymentMethods[@p].Name" value="@pm.Name" />
                                    <div class="flex-grow-1">
                                        <label class="form-check-label mb-1 d-block" for="pm_@p">
                                            <strong>@pm.Name</strong>
                                            @if (!string.IsNullOrEmpty(pm.Details))
                                            {<small class="text-muted">- @pm.Details</small>}
                                        </label>
                                        <input type="text" class="form-control form-control-sm" name="PaymentMethods[@p].Details"
                                               value="@pm.Details" placeholder="Additional details" />
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    <!-- Payment Terms -->
                    <div class="form-section">
                        <h5><i class="bi bi-file-earmark-text text-primary me-2"></i>Payment Terms</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="RequirePaymentOnDropoff"
                                           name="SystemConfig[0].SettingValue" value="true"
                                           @(Model.SystemConfig.Find(s => s.SettingKey == "RequirePaymentOnDropoff")?.SettingValue == "true" ? "checked" : "") />
                                    <label class="form-check-label" for="RequirePaymentOnDropoff">Require payment on drop-off</label>
                                    <input type="hidden" name="SystemConfig[0].SettingKey" value="RequirePaymentOnDropoff" />
                                    <input type="hidden" name="SystemConfig[0].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="RequirePaymentOnDropoff")?.Id ?? 0)" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="AllowPaymentUponPickup"
                                           name="SystemConfig[1].SettingValue" value="true"
                                           @(Model.SystemConfig.Find(s => s.SettingKey == "AllowPaymentUponPickup")?.SettingValue == "true" ? "checked" : "") />
                                    <label class="form-check-label" for="AllowPaymentUponPickup">Allow payment on pickup</label>
                                    <input type="hidden" name="SystemConfig[1].SettingKey" value="AllowPaymentUponPickup" />
                                    <input type="hidden" name="SystemConfig[1].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="AllowPaymentUponPickup")?.Id ?? 0)" />
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Grace period for pickup (days)</label>
                                <input type="number" class="form-control" name="SystemConfig[2].SettingValue" min="1" max="30"
                                       value="@(Model.SystemConfig.Find(s => s.SettingKey=="GracePeriodDays")?.SettingValue ?? "7")" />
                                <input type="hidden" name="SystemConfig[2].SettingKey" value="GracePeriodDays" />
                                <input type="hidden" name="SystemConfig[2].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="GracePeriodDays")?.Id ?? 0)" />
                                <small class="text-muted">Unclaimed orders after this period may incur storage fees</small>
                            </div>
                        </div>
                    </div>

                    <div class="btn-save-section">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save me-2"></i>Save Payment Settings
                        </button>
                    </div>
                </div>
            </div>

            <!-- SYSTEM CONFIG TAB -->
            <div class="tab-pane fade @(ViewBag.ActiveTab == "system-config" ? "show active" : "")" id="system-config" role="tabpanel">
                <div class="tab-card">
                    <!-- Order Management -->
                    <div class="form-section">
                        <h5><i class="bi bi-list-task text-primary me-2"></i>Order Management</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Default order numbering</label>
                                <input type="text" class="form-control" name="SystemConfig[3].SettingValue"
                                       value="@(Model.SystemConfig.Find(s => s.SettingKey=="OrderNumbering")?.SettingValue ?? "#12345")" />
                                <input type="hidden" name="SystemConfig[3].SettingKey" value="OrderNumbering" />
                                <input type="hidden" name="SystemConfig[3].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="OrderNumbering")?.Id ?? 0)" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Auto-delete completed orders after</label>
                                <select class="form-select" name="SystemConfig[4].SettingValue">
                                    @{
                                        var cur = Model.SystemConfig.Find(s => s.SettingKey == "AutoDeleteCompleted")?.SettingValue ?? "Never";
                                    }
                                    <option value="Never" @(cur == "Never" ? "selected" : "")>Never</option>
                                    <option value="30" @(cur == "30" ? "selected" : "")>30 days</option>
                                    <option value="60" @(cur == "60" ? "selected" : "")>60 days</option>
                                    <option value="90" @(cur == "90" ? "selected" : "")>90 days</option>
                                </select>
                                <input type="hidden" name="SystemConfig[4].SettingKey" value="AutoDeleteCompleted" />
                                <input type="hidden" name="SystemConfig[4].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="AutoDeleteCompleted")?.Id ?? 0)" />
                            </div>
                        </div>
                    </div>

                    

                    <!-- Data & Backup -->
                    <div class="form-section">
                        <h5><i class="bi bi-database text-primary me-2"></i>Data & Backup</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="backup-section bg-white p-3 rounded shadow-sm w-100">
                                    <div class="row g-2 align-items-center">

                                        <!-- Last Backup Info -->
                                        <div class="col-12 col-md-8">
                                            <strong>Last Backup:</strong>
                                            <span class="text-muted">
                                                @(Model.SystemConfig.Find(s => s.SettingKey=="LastBackup")?.SettingValue ?? "N/A")
                                            </span>
                                        </div>

                                        <!-- Backup Now Button -->
                                        <div class="col-12 col-md-4">
                                            @using (Html.BeginForm("BackupNow", "Business", FormMethod.Post))
                                            {
                                                <button type="submit" class="btn btn-outline-primary w-100">
                                                    Backup Now
                                                </button>
                                            }
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="EnableDailyBackup" name="SystemConfig[7].SettingValue" value="true"
                                           @(Model.SystemConfig.Find(s => s.SettingKey == "EnableDailyBackup")?.SettingValue == "true" ? "checked" : "") />
                                    <label class="form-check-label" for="EnableDailyBackup">Enable automatic daily backups (3:00 AM)</label>
                                    <input type="hidden" name="SystemConfig[7].SettingKey" value="EnableDailyBackup" />
                                    <input type="hidden" name="SystemConfig[7].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="EnableDailyBackup")?.Id ?? 0)" />
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="d-flex gap-2">
                                    <a href="@Url.Action("ExportCSV", "Business")"
                                       class="btn btn-outline-secondary w-100 w-md-50 shadow-sm">
                                        Export CSV
                                    </a>

                                    <form class="import-form w-100 w-md-50" method="post" enctype="multipart/form-data" action="@Url.Action("ImportCSV", "Business")">
                                        <label class="btn btn-outline-secondary w-100 mb-0 d-flex justify-content-center align-items-center gap-2"
                                               style="cursor: pointer; padding: 10px;">
                                            <span>Import CSV</span>
                                            <i class="bi bi-upload"></i>
                                            <input type="file" name="file" onchange="this.form.submit()" style="display:none;">
                                        </label>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Security -->
                    <div class="form-section">
                        <h5><i class="bi bi-shield-lock text-primary me-2"></i>Security & Access</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="RequirePassword" name="SystemConfig[8].SettingValue" value="true"
                                           @(Model.SystemConfig.Find(s => s.SettingKey == "RequirePassword")?.SettingValue == "true" ? "checked" : "") />
                                    <label class="form-check-label" for="RequirePassword">Require password for staff login</label>
                                    <input type="hidden" name="SystemConfig[8].SettingKey" value="RequirePassword" />
                                    <input type="hidden" name="SystemConfig[8].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="RequirePassword")?.Id ?? 0)" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="EnableAuditLogs" name="SystemConfig[9].SettingValue" value="true"
                                           @(Model.SystemConfig.Find(s => s.SettingKey == "EnableAuditLogs")?.SettingValue == "true" ? "checked" : "") />
                                    <label class="form-check-label" for="EnableAuditLogs">Enable audit logs</label>
                                    <input type="hidden" name="SystemConfig[9].SettingKey" value="EnableAuditLogs" />
                                    <input type="hidden" name="SystemConfig[9].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="EnableAuditLogs")?.Id ?? 0)" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="EnableAutoStatus" name="SystemConfig[5].SettingValue" value="true"
                                           @(Model.SystemConfig.Find(s => s.SettingKey == "EnableAutoStatus")?.SettingValue == "true" ? "checked" : "") />
                                    <label class="form-check-label" for="EnableAutoStatus">Enable automatic status updates</label>
                                    <input type="hidden" name="SystemConfig[5].SettingKey" value="EnableAutoStatus" />
                                    <input type="hidden" name="SystemConfig[5].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="EnableAutoStatus")?.Id ?? 0)" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="SendSMSOnStatusChange" name="SystemConfig[6].SettingValue" value="true"
                                           @(Model.SystemConfig.Find(s => s.SettingKey == "SendSMSOnStatusChange")?.SettingValue == "true" ? "checked" : "") />
                                    <label class="form-check-label" for="SendSMSOnStatusChange">Send SMS on status change</label>
                                    <input type="hidden" name="SystemConfig[6].SettingKey" value="SendSMSOnStatusChange" />
                                    <input type="hidden" name="SystemConfig[6].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="SendSMSOnStatusChange")?.Id ?? 0)" />
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Session timeout (minutes)</label>
                                <input type="number" class="form-control" name="SystemConfig[10].SettingValue" min="5" max="120"
                                       value="@(Model.SystemConfig.Find(s => s.SettingKey=="SessionTimeout")?.SettingValue ?? "30")" />
                                <input type="hidden" name="SystemConfig[10].SettingKey" value="SessionTimeout" />
                                <input type="hidden" name="SystemConfig[10].Id" value="@(Model.SystemConfig.Find(s => s.SettingKey=="SessionTimeout")?.Id ?? 0)" />
                            </div>
                        </div>
                    </div>

                    <div class="btn-save-section">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save me-2"></i>Save System Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<script>
    // Holiday management
    document.getElementById('addHolidayBtn').addEventListener('click', function () {
        var list = document.getElementById('holidaysList');
        var idx = list.children.length;
        var holidayRow = document.createElement('div');
        holidayRow.className = 'holiday-row';
        holidayRow.innerHTML = `
            <input type="hidden" name="Holidays[${idx}].Id" value="0" />
            <div class="row align-items-center g-2">
                <div class="col-md-3">
                    <input type="date" class="form-control form-control-sm" name="Holidays[${idx}].Date" required />
                </div>
                <div class="col-md-8">
                    <input type="text" class="form-control form-control-sm" name="Holidays[${idx}].Description"
                           placeholder="Holiday description" required />
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-sm btn-outline-danger w-100 remove-holiday">×</button>
                </div>
            </div>
        `;
        list.appendChild(holidayRow);
    });

    // Remove holiday
    document.addEventListener('click', function (e) {
        if (e.target && e.target.classList.contains('remove-holiday')) {
            e.target.closest('.holiday-row').remove();
        }
    });

    // Form validation
    (function () {
        'use strict';
        var forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();
</script>

<script>
    function setActiveTab(tabId) {
        // Update a hidden input so the POST knows which tab was active
        document.getElementById("ActiveTabInput").value = tabId;
    }
</script>