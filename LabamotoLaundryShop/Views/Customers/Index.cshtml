@model LabamotoLaundryShop.Models.CustomerViewModel

@{
    ViewBag.Title = "Customer Databse";
    Layout = "~/Views/Shared/_OwnerLayout.cshtml";
}

<style>
    /* Container */
    .customer-container {
        max-width: 1250px;
        margin: 20px auto;
        padding: 30px 40px;
        background: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    /* Heading */
    .customer-container h2 {
        color: #0d6efd;
        font-weight: 600;
        margin-bottom: 15px;
        font-size: 25px;
    }

    /* Controls */
    .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 20px;
        justify-content: space-between;
        align-items: center;
    }

    .controls-left {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        flex: 1;
        min-width: 300px;
    }

    .controls-left input,
    .controls-left select {
        padding: 8px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        min-width: 200px;
    }

    .btn-primary, .btn-outline-primary {
        border-radius: 6px;
        padding: 8px 18px;
    }

    .export-print {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
    }

    /* Table */
    .table-responsive {
        margin-bottom: 20px;
    }

    /* Stats Cards Container */
    .stats-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

        /* Individual Stat Card */
        .stats-cards .card {
            flex: 1;
            min-width: 180px;
            padding: 25px;
            border: none;
            text-align: center;
            border-radius: 12px;
            background: #ffffff;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

            /* Hover effect */
            .stats-cards .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            }

            /* Title */
            .stats-cards .card h5 {
                font-size: 16px;
                color: #0B64E5; /* blue heading */
                margin-bottom: 8px;
            }

            /* Value */
            .stats-cards .card p {
                font-size: 26px;
                color: #000000;
                margin: 0;
            }

    @@media (max-width: 768px) {
        .controls {
            flex-direction: column;
            align-items: stretch;
        }
        .controls-left {
            justify-content: flex-start;
        }
        .export-print {
            flex-direction: column;
        }
    }
    @@media print {
    body * {
        visibility: hidden;
    }
    .table-responsive, .table-responsive * {
        visibility: visible;
    }
    .table-responsive {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
    }
}
</style>

<div class="customer-container">
    <a href="@Url.Action("Dashboard", "Owner")" class="btn btn-outline-secondary mb-3">← Back</a>
    <h2>👥 Customer Database</h2>

    <!-- Controls -->
    <!-- Controls: Search, Filter, Add -->
    <div class="row mb-4 g-2 align-items-center">
        <div class="col-md-5">
            <input type="text" id="searchBox" placeholder="Search by name, phone, email..." class="form-control" />
        </div>
        <div class="col-md-3">
            <select id="filterType" class="form-select">
                <option value="">All Types</option>
                <option value="Regular">Regular</option>
                <option value="VIP">VIP</option>
                <option value="Corporate">Corporate</option>
            </select>
        </div>
        <div class="col-md-4 text-md-end">
            <button type="button" class="btn btn-primary shadow-sm" data-bs-toggle="modal" data-bs-target="#addCustomerModal">
                + Add New Customer
            </button>
        </div>
    </div>

    <!-- Export / Print -->
    <!-- Records Count + Export / Print -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2">
        <div>
            <strong>Customer Records: @Model.TotalCustomers</strong>
        </div>
        <div class="d-flex gap-2 flex-wrap">
            <a href="@Url.Action("ExportExcel", "Customers")" class="btn btn-outline-dark">Export to Excel</a>
            <button type="button" onclick="window.print()" class="btn btn-outline-secondary">Print List</button>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form method="post" action="@Url.Action("Create", "Customers")">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addCustomerModalLabel">Add New Customer</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <!-- Full Name -->
                        <div class="mb-3">
                            <label for="FullName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="FullName" name="FullName" required>
                        </div>

                        <!-- Contact Number -->
                        <div class="mb-3">
                            <label for="ContactNumber" class="form-label">Contact Number</label>
                            <input type="text" class="form-control" id="ContactNumber" name="ContactNumber" required>
                        </div>

                        <!-- Email -->
                        <div class="mb-3">
                            <label for="Email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="Email" name="Email">
                        </div>

                        <!-- Customer Type -->
                        <div class="mb-3">
                            <label for="CustomerType" class="form-label">Customer Type</label>
                            <select class="form-select" id="CustomerType" name="CustomerType" required>
                                <option value="Regular">Regular</option>
                                <option value="VIP">VIP</option>
                                <option value="Corporate">Corporate</option>
                            </select>
                        </div>

                        <!-- Total Orders -->
                        <div class="mb-3">
                            <label for="TotalOrders" class="form-label">Total Orders</label>
                            <input type="number" class="form-control" id="TotalOrders" name="TotalOrders" value="0" min="0" required>
                        </div>

                        <!-- Lifetime Value -->
                        <div class="mb-3">
                            <label for="TotalSpent" class="form-label">Lifetime Value (₱)</label>
                            <input type="number" class="form-control" id="TotalSpent" name="TotalSpent" value="0" step="0.01" min="0" required>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary shadow-sm">Save Customer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Customer Table -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Customer ID</th>
                    <th>Name</th>
                    <th>Contact</th>
                    <th>Type</th>
                    <th>Total Orders</th>
                    <th>Lifetime Value</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var customer in Model.Customers)
                {
                    <tr>
                        <td>@customer.CustomerID</td>
                        <td>@customer.FullName</td>
                        <td>@customer.ContactNumber</td>
                        <td>@customer.CustomerType</td>
                        <td>@customer.TotalOrders</td>
                        <td>₱ @customer.TotalSpent.ToString("N2")</td>
                        <td class="d-flex gap-1">
                            <!--<a href="@Url.Action("View", "Customers", new { id = customer.CustomerID })" class="btn btn-outline-primary btn-sm">View</a>
                            <a href="@Url.Action("Edit", "Customers", new { id = customer.CustomerID })" class="btn btn-outline-warning btn-sm">✏️ Edit</a>-->
                            <!-- View Button -->
                            <button type="button" class="btn btn-outline-primary btn-sm flex-fill"
                                    data-bs-toggle="modal"
                                    data-bs-target="#viewCustomerModal-@customer.CustomerID">
                                👁️ View
                            </button>

                            <!-- Edit Button -->
                            <button type="button" class="btn btn-outline-warning btn-sm flex-fill"
                                    data-bs-toggle="modal"
                                    data-bs-target="#editCustomerModal-@customer.CustomerID">
                                ✏️ Edit
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @foreach (var customer in Model.Customers)
    {
        <!-- View Customer Modal -->
        <div class="modal fade" id="viewCustomerModal-@customer.CustomerID" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">Customer Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>Customer ID:</strong> @customer.CustomerID</p>
                        <p><strong>Full Name:</strong> @customer.FullName</p>
                        <p><strong>Contact Number:</strong> @customer.ContactNumber</p>
                        <p><strong>Email:</strong> @customer.Email</p>
                        <p><strong>Customer Type:</strong> @customer.CustomerType</p>
                        <p><strong>Total Orders:</strong> @customer.TotalOrders</p>
                        <p><strong>Lifetime Value:</strong> ₱ @customer.TotalSpent.ToString("N2")</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    }

    @foreach (var customer in Model.Customers)
    {
        <!-- Edit Customer Modal -->
        <div class="modal fade" id="editCustomerModal-@customer.CustomerID" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">Edit Customer</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form method="post" action="@Url.Action("UpdateCustomer", "Customers")">
                        <div class="modal-body">
                            <input type="hidden" name="CustomerID" value="@customer.CustomerID" />

                            <div class="mb-3">
                                <label class="form-label">Full Name</label>
                                <input type="text" name="FullName" class="form-control" value="@customer.FullName" required />
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Contact Number</label>
                                <input type="text" name="ContactNumber" class="form-control" value="@customer.ContactNumber" required />
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" name="Email" class="form-control" value="@customer.Email" />
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Customer Type</label>
                                <select name="CustomerType" class="form-select" required>
                                    <option value="Regular" @(customer.CustomerType == "Regular" ? "selected" : "")>Regular</option>
                                    <option value="VIP" @(customer.CustomerType == "VIP" ? "selected" : "")>VIP</option>
                                    <option value="Corporate" @(customer.CustomerType == "Corporate" ? "selected" : "")>Corporate</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Total Orders</label>
                                <input type="number" name="TotalOrders" class="form-control" value="@customer.TotalOrders" min="0" />
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Lifetime Value (₱)</label>
                                <input type="number" name="TotalSpent" class="form-control" value="@customer.TotalSpent" step="0.01" min="0" />
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    }


    <!-- Stats -->
    <div class="stats-cards">
        <div class="card"><strong>Total Customers</strong><br />@Model.TotalCustomers</div>
        <div class="card"><strong>VIP Customers</strong><br />@Model.VIPCustomers</div>
        <div class="card"><strong>Corporate Accounts</strong><br />@Model.CorporateAccounts</div>
        <div class="card"><strong>New This Month</strong><br />@Model.NewThisMonth</div>
    </div>
</div>

<script>
    // Optional: implement search/filter functionality
    document.getElementById("searchBox").addEventListener("input", function () {
        // live search logic here
    });
    document.getElementById("filterType").addEventListener("change", function () {
        // filter logic here
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchBox = document.getElementById("searchBox");
        const filterType = document.getElementById("filterType");
        const table = document.querySelector(".table tbody");
        const rows = table.querySelectorAll("tr");

        function filterTable() {
            const searchValue = searchBox.value.toLowerCase();
            const typeValue = filterType.value;

            rows.forEach(row => {
                const name = row.cells[1].innerText.toLowerCase();
                const contact = row.cells[2].innerText.toLowerCase();
                const email = row.cells[3] ? row.cells[3].innerText.toLowerCase() : ""; // if you added email column
                const type = row.cells[3].innerText; // adjust if email column exists

                const matchesSearch = name.includes(searchValue) || contact.includes(searchValue) || email.includes(searchValue);
                const matchesType = typeValue === "" || type === typeValue;

                if (matchesSearch && matchesType) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        }

        searchBox.addEventListener("input", filterTable);
        filterType.addEventListener("change", filterTable);
    });
</script>
