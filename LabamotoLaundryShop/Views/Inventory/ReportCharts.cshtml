@model List<LabamotoLaundryShop.Models.InventoryChartData>

@{
    Layout = "~/Views/Shared/_OwnerLayout.cshtml";
}

<div class="mb-3 card-header d-flex justify-content-between align-items-center">
    <span style="font-size: 25px; font-weight: 600;">
        📊 Inventory Charts & Graphs
    </span>
    <a href="@Url.Action("GenerateReport", "Inventory")" class="custom-link" style="text-decoration: none; color: red; font-size: 30px;">
        &times;
    </a>
</div>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm border-0 p-3">
                <h5 class="mb-3">Total Stock per Category</h5>
                <canvas id="barStockChart"></canvas>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card shadow-sm border-0 p-3">
                <h5 class="mb-3">Stock Status Breakdown</h5>
                <canvas id="pieStatusChart"></canvas>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
        // Prepare data from model
        const categories = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(x => x.Category)));
        const totalStock = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(x => x.TotalStock)));
        const lowStock = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(x => x.LowStockCount)));
        const outOfStock = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(x => x.OutOfStockCount)));

        // BAR CHART: Total Stock per Category
        new Chart(document.getElementById('barStockChart'), {
            type: 'bar',
            data: {
                labels: categories,
                datasets: [{
                    label: 'Total Stock',
                    data: totalStock,
                    backgroundColor: '#0d6efd'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Total Stock per Category' }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // PIE CHART: Stock Status Breakdown
        const pieData = categories.map((cat, index) => lowStock[index] + outOfStock[index]);
        const pieLabels = categories.map(cat => cat);

        new Chart(document.getElementById('pieStatusChart'), {
            type: 'pie',
            data: {
                labels: pieLabels,
                datasets: [{
                    label: 'Stock Status',
                    data: pieData,
                    backgroundColor: pieLabels.map(() => `hsl(${Math.random() * 360}, 70%, 50%)`)
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Low & Out of Stock Items per Category' }
                }
            }
        });
</script>
